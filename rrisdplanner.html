<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RRISD 4-Year Graduation Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Style for PNG export to ensure background is captured */
        .exporting-png {
            background-color: #f9fafb; /* Match the wrapper background */
        }
        /* Basic font setup */
        body {
            font-family: 'Inter', sans-serif; /* Example font */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
// Ensure React and ReactDOM are available from CDN - Destructure hooks from the global React object
const { useState, useEffect, useCallback, useMemo } = React;

// --- Data (Graduation Plans, Endorsements, Subject Map - Course Data is now loaded) ---

const graduationPlansData = {
  foundation: {
    name: "Foundation Plan",
    totalCredits: 23, // Using 23 based on RRISD chart
    requirements: { ELA: 4, Math: 3, Science: 3, SocialStudies: 4, LOTE: 2, FineArts: 1, PE: 1, Electives: 5 }
  },
  foundationEndorsement: {
    name: "Foundation Plan + Endorsement",
    totalCredits: 27, // Using 27 based on RRISD chart
    requirements: { ELA: 4, Math: 4, Science: 4, SocialStudies: 4, LOTE: 2, FineArts: 1, PE: 1, Electives: 7 }
  },
  dla: {
    name: "Distinguished Level of Achievement (DLA)",
    totalCredits: 27, // Using 27 based on RRISD chart
    requirements: { ELA: 4, Math: 4, Science: 4, SocialStudies: 4, LOTE: 2, FineArts: 1, PE: 1, Electives: 7 },
    specificCourses: ['ALG2', 'ALG2ADV'] // Must include Algebra II (or its advanced version)
  }
};

// Simplified Endorsement Check - Focuses on having *some* key courses from the area
const endorsementsData = {
  STEM: {
    name: "STEM",
    description: "Science, Technology, Engineering, & Math. Requires specific sequences or credits in CTE STEM fields, Math, or Science.",
    keyCourses: ['ALG2', 'ALG2ADV', 'CHEM', 'CHEMADV', 'PHYS', 'PHYS1AP', 'CSAP', 'CSP', 'PRECALADV', 'CALCAB', 'CALCBC'],
    minAdvanced: 1
  },
  BusinessIndustry: {
    name: "Business & Industry",
    description: "Requires specific sequences in CTE Business/Industry fields or specific English paths.",
    keyCourses: ['PRINBMF', 'BIM1', 'PRINHOSP', 'CULIARTS', 'PRINARCH', 'ARCHDES1', 'ECO', 'ECOAPMAC', 'ECOAPMIC']
  },
  PublicService: {
    name: "Public Service",
    description: "Requires specific sequences in CTE Public Service fields or JROTC.",
    keyCourses: ['PRINLAW', 'LAWENF1', 'PRINHSCI', 'MEDTERM', 'HSCI_THEORY', 'ANATPHYS', 'JROTC1'] // Added Health Sci courses
  },
  ArtsHumanities: {
    name: "Arts & Humanities",
    description: "Requires sequences in Social Studies, LOTE, Fine Arts, or English.",
    keyCourses: ['WGEO', 'WHIST', 'USHIST', 'GOVT', 'ECO', 'SPAN1', 'SPAN2', 'SPAN3ADV', 'SPANLANGAP', 'ART1', 'BAND1', 'THEATER1', 'ENG4', 'ENG4AP', 'CW']
  },
  Multidisciplinary: {
    name: "Multidisciplinary Studies",
    description: "Requires 4x4 core credits (incl. Chem/Phys & Eng IV) OR 4 Adv courses (AP/IB/Dual Credit).",
    keyCourses: ['ENG4', 'ENG4AP', 'CHEM', 'CHEMADV', 'PHYS', 'PHYS1AP'] // Core check mostly handles this
  }
};

// Mapping subjects to requirement keys in graduationPlansData
const subjectMap = {
    'ELA': 'ELA',
    'Math': 'Math',
    'Science': 'Science',
    'Social Studies': 'SocialStudies',
    'LOTE': 'LOTE',
    'Fine Arts': 'FineArts',
    'PE': 'PE',
    'CTE/Elective': 'Electives',
    'Elective': 'Electives',
};

// --- Components ---

// Displays a message box for warnings/errors
const MessageBox = ({ messages, clearMessages }) => {
    if (!messages || messages.length === 0) return null;
    return (
        <div className="fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50 max-w-sm">
            <div className="flex justify-between items-start">
                <div> <strong className="font-bold block">Alert!</strong> {messages.map((msg, index) => (<span key={index} className="block sm:inline">{msg}</span>))} </div>
                <button onClick={clearMessages} className="ml-4 text-red-500 hover:text-red-700 font-bold text-2xl leading-none">&times;</button>
            </div>
        </div>
    );
};

// Displays a single course card
const CourseCard = ({ course, onRemove, showRemoveButton = true }) => (
    <div className="bg-white p-2 mb-2 rounded-md shadow border border-gray-200 flex justify-between items-center group">
        <div>
            <span className="font-medium text-sm text-gray-800">{course.name}</span>
            <span className="text-xs text-gray-500 ml-2">({course.credits} cr)</span>
             {course.weighted && <span title="Weighted Course" className="ml-1 text-xs bg-yellow-200 text-yellow-800 px-1 rounded">W</span>}
             {course.isAP && <span title="AP Course" className="ml-1 text-xs bg-blue-200 text-blue-800 px-1 rounded">AP</span>}
        </div>
        {showRemoveButton && ( <button onClick={onRemove} className="text-red-500 hover:text-red-700 text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity px-1" aria-label={`Remove ${course.name}`}> &times; </button> )}
    </div>
);

// Generic Modal for selecting courses
const CourseSelector = ({ title, availableCourses, onSelectCourse, onClose, showGradeFilter = false }) => {
    const [searchTerm, setSearchTerm] = useState('');
    const [selectedSubject, setSelectedSubject] = useState('All');
    const [selectedGrade, setSelectedGrade] = useState('All');
    const grades = useMemo(() => { /* ... */ }, [availableCourses, showGradeFilter]);
    const filteredCourses = useMemo(() => { /* ... */ }, [availableCourses, searchTerm, selectedSubject, selectedGrade, showGradeFilter]);
    const subjects = useMemo(() => { /* ... */ }, [availableCourses]);
    return ( <div className="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-40 flex justify-center items-center p-4"> {/* ... modal structure ... */} </div> );
};

// Displays the plan for a single year
const YearPlan = ({ year, selectedCoursesInYear, allCourses, middleSchoolCredits, selectedCoursesByYear, addCourse, removeCourse, setWarnings, findCourseById, checkPrerequisites }) => {
    const [showSelector, setShowSelector] = useState(false);
    const coursesInYear = selectedCoursesInYear.map(findCourseById).filter(Boolean);
    const availableCoursesForSelector = useMemo(() => { /* ... */ }, [allCourses, year, middleSchoolCredits, selectedCoursesByYear, checkPrerequisites]);
    const handleAddCourse = (courseId) => { /* ... */ };
    return ( <div className="bg-gray-100 p-4 rounded-lg shadow-md min-h-[200px] flex flex-col"> {/* ... year plan structure ... */} </div> );
};

// Component to manage Middle School Credits
const MiddleSchoolCredits = ({ middleSchoolCredits, addMiddleSchoolCredit, removeMiddleSchoolCredit, allCourses, findCourseById }) => {
    const [showSelector, setShowSelector] = useState(false);
    const msCourses = middleSchoolCredits.map(findCourseById).filter(Boolean);
    const availableCoursesForSelector = useMemo(() => { /* ... */ }, [allCourses, middleSchoolCredits]);
    const handleAddCredit = (courseId) => { /* ... */ };
    return ( <div className="mb-6 p-4 bg-indigo-50 rounded-lg shadow"> {/* ... ms credits structure ... */} </div> );
};

// Displays graduation progress
const GraduationProgress = ({ credits, plan }) => {
    if (!plan) return <div className="p-4 bg-blue-50 rounded-lg shadow"><p className="text-center text-gray-600">Select a Graduation Plan</p></div>;
    const requirements = plan.requirements;
    const totalRequired = plan.totalCredits;
    const currentTotalInRequiredCategories = Object.entries(credits).filter(/* ... */).reduce(/* ... */, 0);
    const requiredElectives = Math.max(0, totalRequired - currentTotalInRequiredCategories);
    const electiveProgress = credits.Electives;
    return ( <div className="p-4 bg-blue-50 rounded-lg shadow h-full"> {/* ... progress structure ... */} </div> );
};

// Displays DLA status and guidance
const DLAGuidance = ({ selectedCoursesByYear, middleSchoolCredits, planType, findCourseById }) => {
     if (planType !== 'dla') return null;
    const allSelectedIds = useMemo(() => new Set([...middleSchoolCredits, ...Object.values(selectedCoursesByYear).flat()]), [middleSchoolCredits, selectedCoursesByYear]);
    const hasAlgebra2 = graduationPlansData.dla.specificCourses.some(id => allSelectedIds.has(id));
    const algebra2Course = findCourseById('ALG2') || findCourseById('ALG2ADV');
    return ( <div className="p-4 bg-purple-50 rounded-lg shadow mt-4 h-full"> {/* ... dla structure ... */} </div> );
};

// Displays potential endorsements
const EndorsementTracker = ({ selectedCoursesByYear, middleSchoolCredits, planType }) => {
     if (planType === 'foundation') return null;
    const allSelectedIds = useMemo(() => new Set([...middleSchoolCredits, ...Object.values(selectedCoursesByYear).flat()]), [middleSchoolCredits, selectedCoursesByYear]);
    const potentialEndorsements = useMemo(() => { /* ... */ }, [allSelectedIds]);
    return ( <div className="p-4 bg-yellow-50 rounded-lg shadow mt-4 h-full"> {/* ... endorsement structure ... */} </div> );
};

// --- Main App Component ---
function App() {
    // --- State ---
    const [selectedPlanType, setSelectedPlanType] = useState('dla');
    const [selectedCourses, setSelectedCourses] = useState({ 9: [], 10: [], 11: [], 12: [] });
    const [middleSchoolCredits, setMiddleSchoolCredits] = useState([]);
    const [warnings, setWarnings] = useState([]);
    const [isDataLoaded, setIsDataLoaded] = useState(false); // Tracks localStorage load
    const [isClient, setIsClient] = useState(false);
    const [allCoursesData, setAllCoursesData] = useState([]); // Loaded from JSON
    const [isLoading, setIsLoading] = useState(true); // Tracks JSON loading
    const [loadingError, setLoadingError] = useState(null); // Stores JSON loading errors

    // --- Effects ---
    // Effect for client-side check and script loading
    useEffect(() => {
        setIsClient(true);
        // Dynamically load html2canvas script
        const scriptId = 'html2canvas-script';
        if (!document.getElementById(scriptId)) {
            const script = document.createElement('script');
            script.id = scriptId;
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
            script.async = true;
            script.onload = () => console.log('html2canvas loaded successfully.');
            script.onerror = () => console.error('Failed to load html2canvas script.');
            document.body.appendChild(script);
        }
    }, []);

    // Effect to load saved selections from localStorage
     useEffect(() => {
         if (isClient && typeof window !== 'undefined' && window.localStorage) {
             // Load plan type
             const savedPlan = localStorage.getItem('graduationPlan');
             if (savedPlan) setSelectedPlanType(savedPlan);

             // Load selected courses
             const savedCourses = localStorage.getItem('selectedCourses');
             if (savedCourses) {
                 try {
                     const parsedCourses = JSON.parse(savedCourses);
                     // Basic validation for the expected structure
                     if (typeof parsedCourses === 'object' && parsedCourses !== null && [9,10,11,12].every(y => Array.isArray(parsedCourses[y]))) {
                         setSelectedCourses(parsedCourses);
                     } else { localStorage.removeItem('selectedCourses'); } // Clear invalid data
                 } catch (e) { localStorage.removeItem('selectedCourses'); } // Clear if parsing fails
             }

             // Load middle school credits
              const savedMsCredits = localStorage.getItem('middleSchoolCredits');
              if (savedMsCredits) {
                  try {
                      const parsedMsCredits = JSON.parse(savedMsCredits);
                      if (Array.isArray(parsedMsCredits)) {
                          setMiddleSchoolCredits(parsedMsCredits);
                      } else { localStorage.removeItem('middleSchoolCredits'); } // Clear invalid data
                  } catch (e) { localStorage.removeItem('middleSchoolCredits'); } // Clear if parsing fails
              }
         }
          setIsDataLoaded(true); // Mark that the attempt to load from localStorage is complete
     }, [isClient]); // Depend only on isClient to run once client-side

    // Effect to save selections to localStorage
     useEffect(() => {
          // Only save after the initial load attempt is complete and if client-side
          if (isClient && isDataLoaded && typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('graduationPlan', selectedPlanType);
              localStorage.setItem('selectedCourses', JSON.stringify(selectedCourses));
              localStorage.setItem('middleSchoolCredits', JSON.stringify(middleSchoolCredits));
          }
     }, [selectedPlanType, selectedCourses, middleSchoolCredits, isDataLoaded, isClient]); // Dependencies

    // Effect to fetch course data from JSON files
    useEffect(() => {
        const fetchCourseData = async () => {
            const files = [
                'ela_courses.json', 'math_courses.json', 'science_courses.json',
                'social_study_courses.json', 'lote_courses.json', 'art_courses.json',
                'pe_courses.json', 'cte_elective_courses.json', 'elective_courses.json'
            ];
            setIsLoading(true); setLoadingError(null); setAllCoursesData([]);
            const fetchPromises = files.map(file =>
                fetch(file)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error ${response.status} (${response.statusText})`);
                        return response.json().catch(parseError => { throw new Error(`Invalid JSON in file: ${parseError.message}`); });
                    })
                    .then(data => ({ status: 'fulfilled', file: file, data: data }))
                    .catch(error => ({ status: 'rejected', file: file, error: error }))
            );
            try {
                const results = await Promise.all(fetchPromises);
                const firstError = results.find(result => result.status === 'rejected');
                if (firstError) {
                    console.error(`Failed to load course data from ${firstError.file}:`, firstError.error);
                    setLoadingError(`Error loading ${firstError.file}: ${firstError.error.message}. Please check the file content and ensure it's valid JSON.`);
                } else {
                    const combinedCourses = results.flatMap(result => result.data);
                    setAllCoursesData(combinedCourses);
                    console.log("Course data loaded successfully:", combinedCourses.length, "courses");
                }
            } catch (unexpectedError) {
                console.error("Unexpected error during course data fetching:", unexpectedError);
                setLoadingError(`An unexpected error occurred: ${unexpectedError.message}`);
            } finally {
                setIsLoading(false);
            }
        };
        fetchCourseData();
    }, []);


    // --- Utility Functions ---
    const findCourseById = useCallback((id) => allCoursesData.find(course => course.id === id), [allCoursesData]);
    const checkPrerequisites = useCallback((courseId, selectedCoursesByYear, middleSchoolCredits = [], targetYear, coursesData) => {
        // Finds course in the provided coursesData array
        const course = coursesData.find(c => c.id === courseId);
        if (!course || !course.prerequisites || course.prerequisites.length === 0) return { met: true, message: '' };

        // Gathers IDs of courses completed *before* the target year
        const completedCourseIds = new Set([
            ...middleSchoolCredits,
            ...Object.entries(selectedCoursesByYear)
                .filter(([year]) => parseInt(year) < targetYear)
                .flatMap(([, courses]) => courses)
        ]);

        let prerequisitesMet = true;
        let unmetMessages = [];
        // Handles 'A||B' (OR) and single prerequisites
        const requiredSets = course.prerequisites.map(prereq => prereq.split('||').map(s => s.trim()));

        for (const reqSet of requiredSets) {
            const metThisSet = reqSet.some(reqId => completedCourseIds.has(reqId));
            if (!metThisSet) {
                prerequisitesMet = false;
                // Use findCourseById (which uses up-to-date state) to get names for message
                const courseNames = reqSet.map(id => findCourseById(id)?.name || id).join(' OR ');
                unmetMessages.push(`Requires ${courseNames}`);
            }
        }

        // Co-requisite check (warning only)
        if (course.coRequisites && course.coRequisites.length > 0) {
            const currentYearCourses = new Set(selectedCoursesByYear[targetYear] || []);
            const metCoReqs = course.coRequisites.every(reqId => currentYearCourses.has(reqId));
             if (!metCoReqs && prerequisitesMet) { // Only warn if prereqs are met but co-reqs aren't
                 const coReqNames = course.coRequisites.map(id => findCourseById(id)?.name || id).join(', ');
                 unmetMessages.push(`(Co-requisite suggested: ${coReqNames} in the same year)`);
             }
        }
        return { met: prerequisitesMet, message: unmetMessages.join('. ') };
     }, [findCourseById]); // Depends on findCourseById (which depends on allCoursesData)

    const calculateCredits = useCallback((selectedCoursesByYear, middleSchoolCredits = [], coursesData) => {
        const credits = { ELA: 0, Math: 0, Science: 0, SocialStudies: 0, LOTE: 0, FineArts: 0, PE: 0, Electives: 0, Total: 0 };
        const uniqueCourseIds = new Set();
        const allCourseIds = [...middleSchoolCredits, ...Object.values(selectedCoursesByYear).flat()];

        allCourseIds.forEach(courseId => {
            if (uniqueCourseIds.has(courseId)) return;
            // Find course in the provided coursesData array
            const course = coursesData.find(c => c.id === courseId);
            if (course) {
                uniqueCourseIds.add(courseId);
                const subjectCategory = subjectMap[course.subject] || 'Electives';
                let credited = false;
                // Use DLA plan for max requirements check
                const maxRequired = graduationPlansData.dla.requirements[subjectCategory] || 0;

                // LOTE Substitution logic
                if (course.endorsements?.includes('LOTE Sub') && credits.LOTE < graduationPlansData.dla.requirements.LOTE) {
                     credits.LOTE += course.credits; credited = true;
                }
                // Apply to primary subject category if needed
                else if (subjectCategory !== 'Electives' && credits[subjectCategory] < maxRequired) {
                     const creditToAdd = Math.min(course.credits, maxRequired - credits[subjectCategory]);
                     credits[subjectCategory] += creditToAdd;
                     const remainingCredit = course.credits - creditToAdd;
                     if (remainingCredit > 0) credits.Electives += remainingCredit;
                     credited = true;
                }
                // Apply to Electives if not credited elsewhere
                if (!credited) credits.Electives += course.credits;
                 credits.Total += course.credits; // Always add to total
            }
        });
        return credits;
    }, []); // No direct state dependencies, relies on passed data

    // --- Callbacks ---
    const addCourse = useCallback((year, courseId) => {
         if (middleSchoolCredits.includes(courseId)) {
             setWarnings(prev => [...new Set([...prev, `${findCourseById(courseId)?.name || courseId} was already added as a Middle School credit.`])]); return;
         }
         setSelectedCourses(prev => {
             const yearCourses = prev[year] || [];
             return !yearCourses.includes(courseId) ? { ...prev, [year]: [...yearCourses, courseId] } : prev;
         });
          const courseName = findCourseById(courseId)?.name || courseId;
          setWarnings(prev => prev.filter(w => !w.includes(`Prerequisite check for ${courseName}`)));
          setWarnings(prev => prev.filter(w => !w.includes(`Co-requisite suggested for ${courseName}`)));
     }, [middleSchoolCredits, findCourseById]);

    const removeCourse = useCallback((year, courseId) => {
         setSelectedCourses(prev => ({ ...prev, [year]: (prev[year] || []).filter(id => id !== courseId) }));
     }, []);

     const addMiddleSchoolCredit = useCallback((courseId) => {
          const alreadyInHS = Object.values(selectedCourses).flat().includes(courseId);
          if (alreadyInHS) {
              setWarnings(prev => [...new Set([...prev, `${findCourseById(courseId)?.name || courseId} is already selected in your High School plan.`])]); return;
          }
          setMiddleSchoolCredits(prev => !prev.includes(courseId) ? [...prev, courseId] : prev);
      }, [selectedCourses, findCourseById]);

     const removeMiddleSchoolCredit = useCallback((courseId) => {
          setMiddleSchoolCredits(prev => prev.filter(id => id !== courseId));
      }, []);

     const clearWarnings = useCallback(() => setWarnings([]), []);

    // Memoized calculation for display data
    const displayData = useMemo(() => {
        const planDetails = graduationPlansData[selectedPlanType];
        // Pass the current allCoursesData state to the calculation function
        const credits = calculateCredits(selectedCourses, middleSchoolCredits, allCoursesData);
        return { credits, planDetails };
    }, [selectedPlanType, selectedCourses, middleSchoolCredits, allCoursesData, calculateCredits]); // Include all dependencies

    // PNG Export Handler
    const handleExportPNG = useCallback(() => {
        console.log("Export button clicked");
        const exportContent = document.getElementById('plan-export-content');

        // --- FIX START ---
        // Add check for displayData and planDetails before using them
        if (!displayData || !displayData.planDetails) {
             console.error("Cannot export: Plan details not available yet.");
             setWarnings(prev => [...new Set([...prev, "Cannot export: Plan details not available."])]);
             return; // Exit if data isn't ready
        }
        // --- FIX END ---

        if (exportContent && typeof window.html2canvas === 'function') {
            console.log("html2canvas function found, attempting render...");
            exportContent.classList.add('exporting-png');
            setTimeout(() => {
                window.html2canvas(exportContent, { scale: 2, useCORS: true, logging: true, backgroundColor: '#f9fafb' })
                 .then(canvas => {
                    console.log("html2canvas generated canvas");
                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    // Now it's safer to access planDetails.name
                    const filename = `RRISD_Graduation_Plan_${displayData.planDetails.name.replace(/\s+/g, '_') || 'Plan'}.png`;
                    link.download = filename;
                    link.href = image;
                    link.click();
                    console.log("Download triggered.");
                    exportContent.classList.remove('exporting-png');
                }).catch(err => {
                    console.error("Error generating PNG:", err);
                    setWarnings(prev => [...new Set([...prev, `Error generating PNG: ${err.message}. Check console.`])]);
                    exportContent.classList.remove('exporting-png');
                });
            }, 100);
        } else if (!exportContent){
            console.error("Export content area 'plan-export-content' not found");
            setWarnings(prev => [...new Set([...prev, "Could not find content to export."])]);
        } else {
             console.error("html2canvas is not loaded or not a function.");
             setWarnings(prev => [...new Set([...prev, "PNG Export library (html2canvas) not loaded. Please wait or check console."])]);
        }
    // --- FIX: Update dependency array ---
    // Depend on the whole displayData object, as the function uses its properties.
    }, [displayData, setWarnings]);
    // --- End FIX ---

    // --- Render Logic ---
     if (!isClient) return <div className="container mx-auto p-4 font-sans text-center">Initializing Planner...</div>;
     if (isLoading) return <div className="container mx-auto p-4 text-center">Loading course data...</div>;
     if (loadingError) {
         return <div className="container mx-auto p-4 text-center text-red-600 border border-red-300 bg-red-50 rounded p-4">
             <h2 className="text-lg font-semibold mb-2">Error Loading Data</h2> <p>{loadingError}</p>
             <p className="mt-2 text-sm text-gray-700">Please ensure all JSON course files are in the same directory... You may need to run a local web server.</p>
          </div>;
     }

    // Main UI Render
    return (
        <div className="container mx-auto p-4 font-sans">
            <div id="plan-export-content" className="bg-gray-50 p-4 rounded-lg">
                <header className="mb-6 text-center">
                    <h1 className="text-3xl font-bold text-blue-700">RRISD 4-Year Graduation Planner</h1>
                    <p className="text-gray-600">Plan your high school journey!</p>
                    <p className="text-xs text-red-600 mt-1">Disclaimer: Uses representative data...</p>
                </header>
                {/* Pass necessary props down */}
                <MiddleSchoolCredits {...{ middleSchoolCredits, addMiddleSchoolCredit, removeMiddleSchoolCredit, allCourses: allCoursesData, findCourseById }} />
                <div className="mb-6 p-4 bg-gray-50 rounded-lg shadow flex flex-wrap justify-between items-center gap-4">
                    <div>
                        <label htmlFor="plan-select" className="block text-sm font-medium text-gray-700 mb-1">Select Graduation Plan:</label>
                        <select id="plan-select" value={selectedPlanType} onChange={(e) => setSelectedPlanType(e.target.value)} className="w-full md:w-auto p-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            {Object.entries(graduationPlansData).map(([key, plan]) => ( <option key={key} value={key}>{plan.name} ({plan.totalCredits} Credits)</option> ))}
                        </select>
                    </div>
                     <button onClick={handleExportPNG} disabled={isLoading || !!loadingError} className={`px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 transition duration-150 ease-in-out ${isLoading || !!loadingError ? 'opacity-50 cursor-not-allowed' : ''}`}> Export Plan to PNG </button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    {[9, 10, 11, 12].map(year => ( <YearPlan key={year} {...{ year, selectedCoursesInYear: selectedCourses[year] || [], allCourses: allCoursesData, middleSchoolCredits, selectedCoursesByYear: selectedCourses, addCourse, removeCourse, setWarnings, findCourseById, checkPrerequisites }} /> ))}
                </div>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="md:col-span-1"> <GraduationProgress credits={displayData.credits} plan={displayData.planDetails} /> </div>
                    <div className="md:col-span-1"> <EndorsementTracker selectedCoursesByYear={selectedCourses} middleSchoolCredits={middleSchoolCredits} planType={selectedPlanType} /> </div>
                    <div className="md:col-span-1"> <DLAGuidance selectedCoursesByYear={selectedCourses} middleSchoolCredits={middleSchoolCredits} planType={selectedPlanType} findCourseById={findCourseById} /> </div>
                </div>
            </div>
             <MessageBox messages={warnings} clearMessages={clearWarnings} />
             <footer className="text-center mt-8 text-xs text-gray-500"> Data loaded dynamically. Consult official RRISD sources. </footer>
        </div>
    );
}

// Render the App component to the DOM
const container = document.getElementById('root');
const root = ReactDOM.createRoot(container);
root.render(<App />);

    </script>
    </body>
</html>
